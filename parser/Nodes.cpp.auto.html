<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Nodes.cpp</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">Nodes.cpp&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
*  Copyright (C) 1999-2002 Harri Porten (<a href="mailto:porten@kde.org">porten@kde.org</a>)
*  Copyright (C) 2001 Peter Kelly (<a href="mailto:pmk@post.com">pmk@post.com</a>)
*  Copyright (C) 2003, 2004, 2005, 2006, 2007, 2008, 2009 Apple Inc. All rights reserved.
*  Copyright (C) 2007 Cameron Zwarich (<a href="mailto:cwzwarich@uwaterloo.ca">cwzwarich@uwaterloo.ca</a>)
*  Copyright (C) 2007 Maks Orlovich
*  Copyright (C) 2007 Eric Seidel &lt;<a href="mailto:eric@webkit.org">eric@webkit.org</a>&gt;
*
*  This library is free software; you can redistribute it and/or
*  modify it under the terms of the GNU Library General Public
*  License as published by the Free Software Foundation; either
*  version 2 of the License, or (at your option) any later version.
*
*  This library is distributed in the hope that it will be useful,
*  but WITHOUT ANY WARRANTY; without even the implied warranty of
*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
*  Library General Public License for more details.
*
*  You should have received a copy of the GNU Library General Public License
*  along with this library; see the file COPYING.LIB.  If not, write to
*  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
*  Boston, MA 02110-1301, USA.
*
*/</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;config.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;Nodes.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;NodeConstructors.h&quot;</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;BytecodeGenerator.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;CallFrame.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;Debugger.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;JIT.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;JSFunction.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;JSGlobalObject.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;JSStaticScopeObject.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;LabelScope.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;Lexer.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;Operations.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;Parser.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;PropertyNameArray.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;RegExpObject.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;SamplingTool.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;wtf/Assertions.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;wtf/RefCountedLeakCounter.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;wtf/Threading.h&gt;</span>

using namespace WTF;

namespace JSC {


<span class="enscript-comment">// ------------------------------ StatementNode --------------------------------
</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">StatementNode::setLoc</span>(<span class="enscript-type">int</span> firstLine, <span class="enscript-type">int</span> lastLine)
{
    m_lineNumber = firstLine;
    m_lastLine = lastLine;
}

<span class="enscript-comment">// ------------------------------ SourceElements --------------------------------
</span>
<span class="enscript-type">void</span> <span class="enscript-function-name">SourceElements::append</span>(StatementNode* statement)
{
    <span class="enscript-keyword">if</span> (statement-&gt;isEmptyStatement())
        <span class="enscript-keyword">return</span>;
    m_statements.append(statement);
}

StatementNode* <span class="enscript-function-name">SourceElements::singleStatement</span>() <span class="enscript-type">const</span>
{
    size_t size = m_statements.size();
    <span class="enscript-keyword">return</span> size == 1 ? m_statements[0] : 0;
}

<span class="enscript-comment">// ------------------------------ ScopeNode -----------------------------
</span>
<span class="enscript-function-name">ScopeNode::ScopeNode</span>(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, <span class="enscript-type">bool</span> inStrictContext)
    : StatementNode(lineNumber)
    , ParserArenaRefCounted(globalData)
    , m_features(inStrictContext ? StrictModeFeature : NoFeatures)
    , m_numConstants(0)
    , m_statements(0)
{
}

<span class="enscript-function-name">ScopeNode::ScopeNode</span>(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, <span class="enscript-type">const</span> SourceCode&amp; source, SourceElements* children, VarStack* varStack, FunctionStack* funcStack, IdentifierSet&amp; capturedVariables, CodeFeatures features, <span class="enscript-type">int</span> numConstants)
    : StatementNode(lineNumber)
    , ParserArenaRefCounted(globalData)
    , m_features(features)
    , m_source(source)
    , m_numConstants(numConstants)
    , m_statements(children)
{
    m_arena.swap(*globalData-&gt;parserArena);
    <span class="enscript-keyword">if</span> (varStack)
        m_varStack.swap(*varStack);
    <span class="enscript-keyword">if</span> (funcStack)
        m_functionStack.swap(*funcStack);
    m_capturedVariables.swap(capturedVariables);
}

StatementNode* <span class="enscript-function-name">ScopeNode::singleStatement</span>() <span class="enscript-type">const</span>
{
    <span class="enscript-keyword">return</span> m_statements ? m_statements-&gt;singleStatement() : 0;
}

<span class="enscript-comment">// ------------------------------ ProgramNode -----------------------------
</span>
<span class="enscript-type">inline</span> <span class="enscript-function-name">ProgramNode::ProgramNode</span>(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, SourceElements* children, VarStack* varStack, FunctionStack* funcStack, IdentifierSet&amp; capturedVariables, <span class="enscript-type">const</span> SourceCode&amp; source, CodeFeatures features, <span class="enscript-type">int</span> numConstants)
    : ScopeNode(globalData, lineNumber, source, children, varStack, funcStack, capturedVariables, features, numConstants)
{
}

PassRefPtr&lt;ProgramNode&gt; ProgramNode::create(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, SourceElements* children, VarStack* varStack, FunctionStack* funcStack, IdentifierSet&amp; capturedVariables, <span class="enscript-type">const</span> SourceCode&amp; source, CodeFeatures features, <span class="enscript-type">int</span> numConstants)
{
    RefPtr&lt;ProgramNode&gt; node = <span class="enscript-keyword">new</span> ProgramNode(globalData, lineNumber, children, varStack, funcStack,  capturedVariables, source, features, numConstants);

    ASSERT(node-&gt;m_arena.last() == node);
    node-&gt;m_arena.removeLast();
    ASSERT(!node-&gt;m_arena.contains(node.get()));

    <span class="enscript-keyword">return</span> node.release();
}

<span class="enscript-comment">// ------------------------------ EvalNode -----------------------------
</span>
<span class="enscript-type">inline</span> <span class="enscript-function-name">EvalNode::EvalNode</span>(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, SourceElements* children, VarStack* varStack, FunctionStack* funcStack, IdentifierSet&amp; capturedVariables, <span class="enscript-type">const</span> SourceCode&amp; source, CodeFeatures features, <span class="enscript-type">int</span> numConstants)
    : ScopeNode(globalData, lineNumber, source, children, varStack, funcStack, capturedVariables, features, numConstants)
{
}

PassRefPtr&lt;EvalNode&gt; EvalNode::create(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, SourceElements* children, VarStack* varStack, FunctionStack* funcStack, IdentifierSet&amp; capturedVariables, <span class="enscript-type">const</span> SourceCode&amp; source, CodeFeatures features, <span class="enscript-type">int</span> numConstants)
{
    RefPtr&lt;EvalNode&gt; node = <span class="enscript-keyword">new</span> EvalNode(globalData, lineNumber, children, varStack, funcStack, capturedVariables, source, features, numConstants);

    ASSERT(node-&gt;m_arena.last() == node);
    node-&gt;m_arena.removeLast();
    ASSERT(!node-&gt;m_arena.contains(node.get()));

    <span class="enscript-keyword">return</span> node.release();
}

<span class="enscript-comment">// ------------------------------ FunctionBodyNode -----------------------------
</span>
<span class="enscript-function-name">FunctionParameters::FunctionParameters</span>(ParameterNode* firstParameter)
{
    <span class="enscript-keyword">for</span> (ParameterNode* parameter = firstParameter; parameter; parameter = parameter-&gt;nextParam())
        append(parameter-&gt;ident());
}

<span class="enscript-type">inline</span> <span class="enscript-function-name">FunctionBodyNode::FunctionBodyNode</span>(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, <span class="enscript-type">bool</span> inStrictContext)
    : ScopeNode(globalData, lineNumber, inStrictContext)
{
}

<span class="enscript-type">inline</span> <span class="enscript-function-name">FunctionBodyNode::FunctionBodyNode</span>(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, SourceElements* children, VarStack* varStack, FunctionStack* funcStack, IdentifierSet&amp; capturedVariables, <span class="enscript-type">const</span> SourceCode&amp; sourceCode, CodeFeatures features, <span class="enscript-type">int</span> numConstants)
    : ScopeNode(globalData, lineNumber, sourceCode, children, varStack, funcStack, capturedVariables, features, numConstants)
{
}

<span class="enscript-type">void</span> <span class="enscript-function-name">FunctionBodyNode::finishParsing</span>(<span class="enscript-type">const</span> SourceCode&amp; source, ParameterNode* firstParameter, <span class="enscript-type">const</span> Identifier&amp; ident)
{
    setSource(source);
    finishParsing(FunctionParameters::create(firstParameter), ident);
}

<span class="enscript-type">void</span> <span class="enscript-function-name">FunctionBodyNode::finishParsing</span>(PassRefPtr&lt;FunctionParameters&gt; parameters, <span class="enscript-type">const</span> Identifier&amp; ident)
{
    ASSERT(!source().isNull());
    m_parameters = parameters;
    m_ident = ident;
}

FunctionBodyNode* <span class="enscript-function-name">FunctionBodyNode::create</span>(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, <span class="enscript-type">bool</span> inStrictContext)
{
    <span class="enscript-keyword">return</span> <span class="enscript-keyword">new</span> FunctionBodyNode(globalData, lineNumber, inStrictContext);
}

PassRefPtr&lt;FunctionBodyNode&gt; FunctionBodyNode::create(JSGlobalData* globalData, <span class="enscript-type">int</span> lineNumber, SourceElements* children, VarStack* varStack, FunctionStack* funcStack, IdentifierSet&amp; capturedVariables, <span class="enscript-type">const</span> SourceCode&amp; sourceCode, CodeFeatures features, <span class="enscript-type">int</span> numConstants)
{
    RefPtr&lt;FunctionBodyNode&gt; node = <span class="enscript-keyword">new</span> FunctionBodyNode(globalData, lineNumber, children, varStack, funcStack, capturedVariables, sourceCode, features, numConstants);

    ASSERT(node-&gt;m_arena.last() == node);
    node-&gt;m_arena.removeLast();
    ASSERT(!node-&gt;m_arena.contains(node.get()));

    <span class="enscript-keyword">return</span> node.release();
}

} <span class="enscript-comment">// namespace JSC
</span></pre>
<hr />
</body></html>